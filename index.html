<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maison Des Fleurs</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-color: #0A0A0C; --text-main: #F4F0EB; --accent: #D4AF37; --card-bg: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); padding-bottom: 80px; }
        h1, h2 { font-family: 'Playfair Display', serif; font-weight: 400; }
        
        /* Каталог */
        .catalog { padding: 20px; display: grid; gap: 20px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 15px; display: flex; flex-direction: column; }
        .card-title { font-size: 20px; color: var(--accent); margin-bottom: 10px; }
        .card-price { font-size: 18px; margin-bottom: 15px; }
        
        /* Кнопки добавления/количества */
        .add-btn { background: transparent; border: 1px solid var(--accent); color: var(--text-main); padding: 10px; border-radius: 20px; text-transform: uppercase; cursor: pointer; transition: 0.3s; width: 100%; }
        .add-btn:hover { background: var(--accent); color: #000; }
        
        .qty-controls { display: none; justify-content: space-between; align-items: center; background: var(--card-bg); border-radius: 20px; padding: 5px 15px; }
        .qty-controls.active { display: flex; }
        .qty-btn { background: transparent; border: none; color: var(--accent); font-size: 20px; width: 30px; cursor: pointer; }
        
        /* Плавающая кнопка корзины */
        .cart-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #1A1311; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--accent); transform: translateY(100%); transition: 0.3s; z-index: 10; }
        .cart-bar.active { transform: translateY(0); }
        .cart-total { font-size: 18px; font-family: 'Playfair Display', serif; }
        .checkout-btn { background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 20px; font-weight: 600; text-transform: uppercase; cursor: pointer; }

        /* Форма заказа (Модалка) */
        .checkout-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 100; padding: 20px; overflow-y: auto; display: none; }
        .checkout-modal.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #A09D98; margin-bottom: 5px; text-transform: uppercase; }
        input, select, textarea { width: 100%; background: var(--card-bg); border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; font-size: 14px; outline: none; }
        input:focus, select:focus, textarea:focus { border-color: var(--accent); }
        .radio-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .radio-group label { background: var(--card-bg); padding: 10px; border-radius: 10px; flex: 1; text-align: center; border: 1px solid #333; cursor: pointer; }
        .radio-group input[type="radio"]:checked + label { border-color: var(--accent); color: var(--accent); }
        .radio-group input[type="radio"] { display: none; }
        
        .submit-order { background: var(--accent); color: #000; border: none; padding: 15px; border-radius: 10px; width: 100%; font-weight: bold; text-transform: uppercase; margin-top: 20px; cursor: pointer; }
        .close-modal { color: var(--text-main); text-align: right; display: block; margin-bottom: 20px; text-decoration: none; font-size: 24px; }
    </style>
</head>
<body>
    <div style="padding: 20px; text-align: center;">
        <h1>L'Éphémère</h1>
        <p style="color: #A09D98; font-size: 12px; letter-spacing: 2px;">БУТИК ФЛОРИСТИКИ</p>
    </div>

    <div class="catalog">
        <div class="card" data-id="1" data-name="Эквадорская Роза" data-price="2990">
            <h2 class="card-title">Эквадорская Роза</h2>
            <div class="card-price">2 990 ₽</div>
            <button class="add-btn" onclick="addToCart(this)">В корзину</button>
            <div class="qty-controls">
                <button class="qty-btn" onclick="updateQty(this, -1)">-</button>
                <span class="qty-val">1</span>
                <button class="qty-btn" onclick="updateQty(this, 1)">+</button>
            </div>
        </div>
        
        <div class="card" data-id="2" data-name="Сара Бернар" data-price="4590">
            <h2 class="card-title">Пионы Сара Бернар</h2>
            <div class="card-price">4 590 ₽</div>
            <button class="add-btn" onclick="addToCart(this)">В корзину</button>
            <div class="qty-controls">
                <button class="qty-btn" onclick="updateQty(this, -1)">-</button>
                <span class="qty-val">1</span>
                <button class="qty-btn" onclick="updateQty(this, 1)">+</button>
            </div>
        </div>
    </div>

    <div class="cart-bar" id="cart-bar">
        <div class="cart-total" id="cart-total">0 ₽</div>
        <button class="checkout-btn" onclick="openCheckout()">Оформить</button>
    </div>

    <div class="checkout-modal" id="checkout-modal">
        <span class="close-modal" onclick="closeCheckout()">✕</span>
        <h2 style="margin-bottom: 20px; color: var(--accent);">Оформление</h2>
        
        <div class="radio-group">
            <input type="radio" id="del" name="delivery" value="Доставка" checked onchange="toggleAddress(true)">
            <label for="del">Доставка</label>
            <input type="radio" id="pickup" name="delivery" value="Самовывоз" onchange="toggleAddress(false)">
            <label for="pickup">Самовывоз</label>
        </div>

        <div class="form-group">
            <label>Имя получателя</label>
            <input type="text" id="c_name" placeholder="Иван Иванов">
        </div>
        <div class="form-group">
            <label>Телефон</label>
            <input type="tel" id="c_phone" placeholder="+7 (999) 000-00-00">
        </div>
        <div class="form-group" id="address-group">
            <label>Адрес доставки</label>
            <input type="text" id="c_address" placeholder="Улица, дом, квартира">
        </div>
        <div class="form-group">
            <label>Время (когда нужно)</label>
            <input type="text" id="c_time" placeholder="Сегодня к 18:00">
        </div>
        <div class="form-group">
            <label>Комментарий (пожелания)</label>
            <textarea id="c_comment" rows="3" placeholder="Записка в букет, особенности доставки..."></textarea>
        </div>

        <button class="submit-order" onclick="sendOrder()">Подтвердить заказ</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let cart = {}; // Объект корзины

        function addToCart(btn) {
            const card = btn.closest('.card');
            const id = card.dataset.id;
            
            cart[id] = {
                name: card.dataset.name,
                price: parseInt(card.dataset.price),
                qty: 1
            };
            
            btn.style.display = 'none';
            card.querySelector('.qty-controls').classList.add('active');
            updateCartUI();
        }

        function updateQty(btn, change) {
            const card = btn.closest('.card');
            const id = card.dataset.id;
            
            cart[id].qty += change;
            
            if (cart[id].qty <= 0) {
                delete cart[id];
                card.querySelector('.qty-controls').classList.remove('active');
                card.querySelector('.add-btn').style.display = 'block';
            } else {
                card.querySelector('.qty-val').innerText = cart[id].qty;
            }
            updateCartUI();
        }

        function updateCartUI() {
            let total = 0;
            let itemsCount = 0;
            
            for (let id in cart) {
                total += cart[id].price * cart[id].qty;
                itemsCount += cart[id].qty;
            }
            
            document.getElementById('cart-total').innerText = total + ' ₽';
            
            const cartBar = document.getElementById('cart-bar');
            if (itemsCount > 0) {
                cartBar.classList.add('active');
            } else {
                cartBar.classList.remove('active');
                closeCheckout();
            }
        }

        function openCheckout() {
            document.getElementById('checkout-modal').classList.add('active');
            tg.MainButton.hide(); // Прячем системную кнопку ТГ, если использовали
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.remove('active');
        }

        function toggleAddress(show) {
            document.getElementById('address-group').style.display = show ? 'block' : 'none';
        }

        function sendOrder() {
            // Собираем данные
            const deliveryType = document.querySelector('input[name="delivery"]:checked').value;
            const name = document.getElementById('c_name').value;
            const phone = document.getElementById('c_phone').value;
            const address = document.getElementById('c_address').value;
            const time = document.getElementById('c_time').value;
            const comment = document.getElementById('c_comment').value;

            if (!name || !phone || !time || (deliveryType === 'Доставка' && !address)) {
                tg.showAlert("Пожалуйста, заполните все обязательные поля");
                return;
            }

            let itemsArr = [];
            let totalSum = 0;
            for (let id in cart) {
                itemsArr.push(cart[id]);
                totalSum += cart[id].price * cart[id].qty;
            }

            const finalData = {
                items: itemsArr,
                total: totalSum,
                delivery_type: deliveryType,
                name: name,
                phone: phone,
                address: address,
                time: time,
                comment: comment
            };

            tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(JSON.stringify(finalData));
        }
    </script>
</body>
</html>